<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:CSimple.ViewModels"
             xmlns:models="clr-namespace:CSimple.Models"
             xmlns:local="clr-namespace:CSimple.Pages"
             xmlns:converters="clr-namespace:CSimple.Converters"
             x:DataType="viewmodels:OrientPageViewModel"
             x:Class="CSimple.Pages.OrientPage"
             Title="Orient - Pipeline Editor">
    <ContentPage.Resources>
        <!-- Ensure IsNotNullConverter is defined -->
        <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
    </ContentPage.Resources>
    <!-- Define Grid Rows: Auto for toolbar, * for canvas -->
    <Grid RowDefinitions="Auto, *">
        <!-- Top Toolbar (in Row 0) -->
        <Border Grid.Row="0"
                StrokeThickness="0"
                BackgroundColor="{AppThemeBinding Light=#E0FFFFFF, Dark=#E0333333}"
                Padding="10,5"
                Margin="10,10,10,0"
                VerticalOptions="Start"
                HorizontalOptions="FillAndExpand"
                StrokeShape="RoundRectangle 10">
            <HorizontalStackLayout Spacing="10"
                                   VerticalOptions="Center">
                <Label Text="Add Model:"
                       VerticalOptions="Center"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                <Picker Title="Select Model Type"
                        ItemsSource="{Binding AvailableModels}"
                        ItemDisplayBinding="{Binding Name}"
                        x:Name="ModelPicker"
                        WidthRequest="200"
                        VerticalOptions="Center"
                        BackgroundColor="{AppThemeBinding Light=White, Dark=Gray}"
                        TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                <Button Command="{Binding AddModelNodeCommand}"
                        CommandParameter="{Binding Source={x:Reference ModelPicker}, Path=SelectedItem}"
                        BackgroundColor="{StaticResource Primary}"
                        Text="Add"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="12,6"
                        ToolTipProperties.Text="Add Selected Model Node" />
                <Button Command="{Binding DeleteSelectedNodeCommand}"
                        BackgroundColor="{StaticResource Error}"
                        Text="Delete"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="12,6"
                        ToolTipProperties.Text="Delete Selected Node" />
                <!-- Add Zoom/Pan buttons later if needed -->
            </HorizontalStackLayout>
        </Border>
        <!-- GraphicsView for drawing nodes and connections (in Row 1) -->
        <GraphicsView Grid.Row="1"
                      x:Name="NodeCanvas"
                      Drawable="{Binding Source={RelativeSource AncestorType={x:Type local:OrientPage}}, Path=NodeDrawable}"
                      StartInteraction="OnCanvasStartInteraction"
                      DragInteraction="OnCanvasDragInteraction"
                      EndInteraction="OnCanvasEndInteraction"
                      CancelInteraction="OnCanvasCancelInteraction"
                      BackgroundColor="{AppThemeBinding Light=WhiteSmoke, Dark=#1e1e1e}" />
        <!-- Selected Node Info Panel (Overlay in Row 1) -->
        <Border Grid.Row="1"
                Stroke="{AppThemeBinding Light=Gray, Dark=LightGray}"
                BackgroundColor="{AppThemeBinding Light=#F0FFFFFF, Dark=#F0444444}"
                Padding="10"
                Margin="10"
                VerticalOptions="End"
                HorizontalOptions="Start"
                StrokeShape="RoundRectangle 8"
                IsVisible="{Binding SelectedNode, Converter={StaticResource IsNotNullConverter}}"
                WidthRequest="200">
            <VerticalStackLayout Spacing="4">
                <Label Text="Selected Node"
                       FontSize="12"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=Black, Dark=WhiteSmoke}" />
                <Label Text="{Binding SelectedNode.Name}"
                       FontSize="14"
                       LineBreakMode="TailTruncation"
                       TextColor="{AppThemeBinding Light=Black, Dark=WhiteSmoke}" />
                <Label Text="{Binding SelectedNode.Type, StringFormat='Type: {0}'}"
                       FontSize="10"
                       TextColor="{AppThemeBinding Light=DarkSlateGray, Dark=LightGray}" />
                <!-- Add more details here if needed -->
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentPage>