<?xml version="1.0" encoding="utf-8"?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CSimple.Components.CapturePreviewCard"
             x:Name="root">
    <Border Style="{StaticResource ModernCardStyle}"
            FlexLayout.Basis="{OnIdiom Phone=100%, Default=48%}"
            FlexLayout.Grow="1"
            MinimumWidthRequest="320">
        <VerticalStackLayout Spacing="12">
            <Grid ColumnDefinitions="*, Auto">
                <Label Text="Capture Preview"
                       Style="{StaticResource SubHeaderStyle}"
                       VerticalOptions="Center" />
                <HorizontalStackLayout Grid.Column="1"
                                       Spacing="8"
                                       VerticalOptions="Center">
                    <Label Text="Show Feeds"
                           VerticalOptions="Center"
                           TextColor="{StaticResource TextPrimary}"
                           FontSize="14" />
                    <Switch x:Name="PreviewToggle"
                            IsToggled="{Binding Source={x:Reference root}, Path=IsPreviewEnabled}"
                            Toggled="OnPreviewToggled"
                            OnColor="{StaticResource Primary}"
                            ThumbColor="{StaticResource TextOnPrimary}" />
                </HorizontalStackLayout>
            </Grid>
            <Grid RowDefinitions="Auto,Auto,Auto"
                  ColumnDefinitions="*,*"
                  Margin="0,8">
                <!-- Screen Preview -->
                <VerticalStackLayout Grid.Row="0"
                                     Grid.Column="0"
                                     Margin="0,0,6,4"
                                     HorizontalOptions="FillAndExpand">
                    <Label Text="Screen Capture"
                           Style="{StaticResource CaptionStyle}" />
                    <Frame Style="{StaticResource PreviewFrameStyle}"
                           HeightRequest="180"
                           WidthRequest="{OnPlatform WinUI=240, Default=160}"
                           HorizontalOptions="FillAndExpand"
                           Margin="0,4,0,0">
                        <Grid>
                            <Image x:Name="ScreenCaptureImage"
                                   Source="{Binding Source={x:Reference Name=root}, Path=ScreenCaptureSource}"
                                   Aspect="AspectFill"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="FillAndExpand" />
                            <!-- Preview disabled message -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference root}, Path=IsPreviewDisabled}">
                                <Label Text="Preview disabled"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource TextOnPrimary}"
                                       FontSize="14" />
                            </Grid>
                            <!-- Overlay and loading indicator for screen -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference root}, Path=IsScreenWaiting}">
                                <VerticalStackLayout HorizontalOptions="Center"
                                                     VerticalOptions="Center">
                                    <ActivityIndicator IsRunning="{Binding Source={x:Reference root}, Path=IsLoadingScreenPreview}"
                                                       Color="{StaticResource Primary}"
                                                       HeightRequest="40"
                                                       WidthRequest="40" />
                                    <Label x:Name="ScreenCaptureStatus"
                                           Text="Waiting for screen feed..."
                                           HorizontalOptions="Center"
                                           TextColor="{StaticResource TextOnPrimary}"
                                           FontSize="12"
                                           MaxLines="2"
                                           LineBreakMode="WordWrap"
                                           HorizontalTextAlignment="Center"
                                           Margin="8,8,8,0" />
                                </VerticalStackLayout>
                            </Grid>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
                <!-- Webcam Preview -->
                <VerticalStackLayout Grid.Row="0"
                                     Grid.Column="1"
                                     Margin="6,0,0,4"
                                     HorizontalOptions="FillAndExpand">
                    <Label Text="Webcam Feed"
                           Style="{StaticResource CaptionStyle}" />
                    <Frame Style="{StaticResource PreviewFrameStyle}"
                           HeightRequest="180"
                           WidthRequest="{OnPlatform WinUI=240, Default=160}"
                           HorizontalOptions="FillAndExpand"
                           Margin="0,4,0,0">
                        <Grid>
                            <Image x:Name="WebcamCaptureImage"
                                   Source="{Binding Source={x:Reference Name=root}, Path=WebcamCaptureSource}"
                                   Aspect="AspectFill"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="FillAndExpand" />
                            <!-- Preview disabled message -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference root}, Path=IsPreviewDisabled}">
                                <Label Text="Preview disabled"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       TextColor="{StaticResource TextOnPrimary}"
                                       FontSize="14" />
                            </Grid>
                            <!-- Overlay and loading indicator for webcam -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference root}, Path=IsWebcamWaiting}">
                                <VerticalStackLayout HorizontalOptions="Center"
                                                     VerticalOptions="Center">
                                    <ActivityIndicator IsRunning="{Binding Source={x:Reference root}, Path=IsLoadingWebcamPreview}"
                                                       Color="{StaticResource Primary}"
                                                       HeightRequest="40"
                                                       WidthRequest="40" />
                                    <Label x:Name="WebcamCaptureStatus"
                                           Text="Waiting for webcam feed..."
                                           HorizontalOptions="Center"
                                           TextColor="{StaticResource TextOnPrimary}"
                                           FontSize="12"
                                           MaxLines="2"
                                           LineBreakMode="WordWrap"
                                           HorizontalTextAlignment="Center"
                                           Margin="8,8,8,0" />
                                </VerticalStackLayout>
                            </Grid>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
                <!-- Enhanced Input Activity Visualization -->
                <Frame Grid.Row="1"
                       Grid.Column="0"
                       Grid.ColumnSpan="2"
                       Margin="0,12,0,0"
                       Style="{StaticResource PreviewFrameStyle}"
                       Padding="12">
                    <Grid RowDefinitions="Auto,*,Auto"
                          RowSpacing="8">
                        <Label Text="Input Activity"
                               Style="{StaticResource CaptionStyle}"
                               Margin="0,0,0,4" />
                        <Grid Grid.Row="1"
                              ColumnDefinitions="Auto,*"
                              ColumnSpacing="16">
                            <!-- Enhanced Mouse Visualization with modern design -->
                            <Border Grid.Column="0"
                                    StrokeShape="RoundRectangle 16,16,16,16"
                                    StrokeThickness="1.5"
                                    Stroke="{StaticResource BorderColor}"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundPrimary}, Dark={StaticResource BackgroundTertiary}}"
                                    WidthRequest="90"
                                    HeightRequest="140"
                                    VerticalOptions="Start"
                                    Padding="4">
                                <Grid RowDefinitions="Auto,*,Auto"
                                      RowSpacing="4">
                                    <!-- Left and Right Mouse Buttons with improved styling -->
                                    <Grid ColumnDefinitions="*,*"
                                          Grid.Row="0">
                                        <Border x:Name="LeftMouseButton"
                                                Grid.Column="0"
                                                Margin="4"
                                                StrokeThickness="1.5"
                                                Stroke="{StaticResource BorderColor}"
                                                BackgroundColor="{StaticResource BackgroundPrimary}"
                                                StrokeShape="RoundRectangle 8,8,0,8">
                                            <Label Text="L"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center"
                                                   TextColor="{StaticResource TextPrimary}"
                                                   FontSize="14"
                                                   FontAttributes="Bold" />
                                        </Border>
                                        <Border x:Name="RightMouseButton"
                                                Grid.Column="1"
                                                Margin="4"
                                                StrokeThickness="1.5"
                                                Stroke="{StaticResource BorderColor}"
                                                BackgroundColor="{StaticResource BackgroundPrimary}"
                                                StrokeShape="RoundRectangle 0,8,8,8">
                                            <Label Text="R"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center"
                                                   TextColor="{StaticResource TextPrimary}"
                                                   FontSize="14"
                                                   FontAttributes="Bold" />
                                        </Border>
                                    </Grid>
                                    <!-- Mouse Body with improved design -->
                                    <Border Grid.Row="1"
                                            Margin="4,0,4,0"
                                            StrokeThickness="1.5"
                                            Stroke="{StaticResource BorderColor}"
                                            BackgroundColor="{StaticResource BackgroundPrimary}"
                                            StrokeShape="RoundRectangle 10,10,10,10">
                                        <!-- Scroll Wheel with subtle shine effect -->
                                        <Grid>
                                            <Border x:Name="MiddleMouseButton"
                                                    WidthRequest="20"
                                                    HeightRequest="20"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="Start"
                                                    Margin="0,10,0,0"
                                                    StrokeThickness="1"
                                                    Stroke="{StaticResource BorderColor}"
                                                    BackgroundColor="{StaticResource BackgroundSecondary}"
                                                    StrokeShape="Ellipse" />
                                            <!-- Scroll wheel highlight -->
                                            <Border WidthRequest="18"
                                                    HeightRequest="8"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="Start"
                                                    Margin="0,11,0,0"
                                                    StrokeThickness="0"
                                                    BackgroundColor="#20FFFFFF"
                                                    StrokeShape="Ellipse" />
                                        </Grid>
                                    </Border>
                                    <!-- Mouse Movement Indicators - Fixed positioning -->
                                    <AbsoluteLayout Grid.Row="0"
                                                    Grid.RowSpan="3"
                                                    HorizontalOptions="Fill"
                                                    VerticalOptions="Fill">
                                        <!-- Up Arrow - Centered at top -->
                                        <Path x:Name="MouseUpArrow"
                                              AbsoluteLayout.LayoutBounds="0.5,0,20,16"
                                              AbsoluteLayout.LayoutFlags="PositionProportional"
                                              Data="M 10,0 L 0,14 L 20,14 Z"
                                              Fill="Transparent"
                                              Stroke="{StaticResource TextSecondary}"
                                              StrokeThickness="2"
                                              StrokeLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Opacity="0.7" />
                                        <!-- Down Arrow - Centered at bottom -->
                                        <Path x:Name="MouseDownArrow"
                                              AbsoluteLayout.LayoutBounds="0.5,1,20,16"
                                              AbsoluteLayout.LayoutFlags="PositionProportional"
                                              Data="M 10,16 L 0,2 L 20,2 Z"
                                              Fill="Transparent"
                                              Stroke="{StaticResource TextSecondary}"
                                              StrokeThickness="2"
                                              StrokeLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Opacity="0.7" />
                                        <!-- Left Arrow - Centered at left -->
                                        <Path x:Name="MouseLeftArrow"
                                              AbsoluteLayout.LayoutBounds="0,0.5,16,20"
                                              AbsoluteLayout.LayoutFlags="PositionProportional"
                                              Data="M 0,10 L 14,0 L 14,20 Z"
                                              Fill="Transparent"
                                              Stroke="{StaticResource TextSecondary}"
                                              StrokeThickness="2"
                                              StrokeLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Opacity="0.7" />
                                        <!-- Right Arrow - Centered at right -->
                                        <Path x:Name="MouseRightArrow"
                                              AbsoluteLayout.LayoutBounds="1,0.5,16,20"
                                              AbsoluteLayout.LayoutFlags="PositionProportional"
                                              Data="M 16,10 L 2,0 L 2,20 Z"
                                              Fill="Transparent"
                                              Stroke="{StaticResource TextSecondary}"
                                              StrokeThickness="2"
                                              StrokeLineCap="Round"
                                              StrokeLineJoin="Round"
                                              Opacity="0.7" />
                                    </AbsoluteLayout>
                                </Grid>
                            </Border>
                            <!-- Enhanced Keyboard Visualization -->
                            <ScrollView Grid.Column="1"
                                        Orientation="Both"
                                        VerticalOptions="Start"
                                        HorizontalScrollBarVisibility="Always"
                                        VerticalScrollBarVisibility="Always">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto"
                                      RowSpacing="4"
                                      Padding="2">
                                    <!-- Modern keyboard styling for all rows -->
                                    <!-- Function Key Row -->
                                    <Grid Grid.Row="0"
                                          ColumnDefinitions="*,*,*,*,*,*,*,*,*,*,*,*"
                                          ColumnSpacing="4">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyEsc">
                                            <Label Text="Esc"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="KeyF1">
                                            <Label Text="F1"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeyF2">
                                            <Label Text="F2"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="KeyF3">
                                            <Label Text="F3"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="KeyF4">
                                            <Label Text="F4"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="5"
                                                x:Name="KeyF5">
                                            <Label Text="F5"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="6"
                                                x:Name="KeyF6">
                                            <Label Text="F6"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="7"
                                                x:Name="KeyF7">
                                            <Label Text="F7"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="8"
                                                x:Name="KeyF8">
                                            <Label Text="F8"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="9"
                                                x:Name="KeyF9">
                                            <Label Text="F9"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="10"
                                                x:Name="KeyF10">
                                            <Label Text="F10"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="11"
                                                x:Name="KeyF11">
                                            <Label Text="F11"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                    </Grid>
                                    <!-- Number Row -->
                                    <Grid Grid.Row="1"
                                          ColumnDefinitions="*,*,*,*,*,*,*,*,*,*,*,*,*,2*"
                                          ColumnSpacing="2">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyTilde">
                                            <Label Text="`" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="Key1">
                                            <Label Text="1" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="Key2">
                                            <Label Text="2" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="Key3">
                                            <Label Text="3" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="Key4">
                                            <Label Text="4" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="5"
                                                x:Name="Key5">
                                            <Label Text="5" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="6"
                                                x:Name="Key6">
                                            <Label Text="6" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="7"
                                                x:Name="Key7">
                                            <Label Text="7" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="8">
                                            <Label Text="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="9"
                                                x:Name="Key9">
                                            <Label Text="9" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="10"
                                                x:Name="Key0">
                                            <Label Text="0" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="11"
                                                x:Name="KeyMinus">
                                            <Label Text="-" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="12"
                                                x:Name="KeyPlus">
                                            <Label Text="+" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="13"
                                                x:Name="KeyBackspace">
                                            <Label Text="Backspace"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                    </Grid>
                                    <!-- Add Tab key row -->
                                    <Grid Grid.Row="2"
                                          ColumnDefinitions="1.5*,*,*,*,*,*,*,*,*,*,*,1.5*"
                                          ColumnSpacing="2">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyTab">
                                            <Label Text="Tab"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="KeyQ">
                                            <Label Text="Q"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeyW">
                                            <Label Text="W"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="KeyE">
                                            <Label Text="E"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="KeyR">
                                            <Label Text="R"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="5"
                                                x:Name="KeyT">
                                            <Label Text="T"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="6"
                                                x:Name="KeyY">
                                            <Label Text="Y"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="7"
                                                x:Name="KeyU">
                                            <Label Text="U"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="8"
                                                x:Name="KeyI">
                                            <Label Text="I"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="9"
                                                x:Name="KeyO">
                                            <Label Text="O"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="10"
                                                x:Name="KeyP">
                                            <Label Text="P"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="11"
                                                x:Name="KeyEnter">
                                            <Label Text="Enter"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                    </Grid>
                                    <!-- Add Caps Lock to ASDF row -->
                                    <Grid Grid.Row="3"
                                          ColumnDefinitions="1.75*,*,*,*,*,*,*,*,*,*,1.25*"
                                          ColumnSpacing="2">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyCapsLock">
                                            <Label Text="Caps"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="KeyA">
                                            <Label Text="A"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeyS">
                                            <Label Text="S"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="KeyD">
                                            <Label Text="D"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="KeyF">
                                            <Label Text="F"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="5"
                                                x:Name="KeyG">
                                            <Label Text="G"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="6"
                                                x:Name="KeyH">
                                            <Label Text="H"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="7"
                                                x:Name="KeyJ">
                                            <Label Text="J"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="8"
                                                x:Name="KeyK">
                                            <Label Text="K"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="9"
                                                x:Name="KeyL">
                                            <Label Text="L"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="10"
                                                x:Name="KeyEnter2">
                                            <Label Text="Enter"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                    </Grid>
                                    <!-- Add Shift to ZXCV row -->
                                    <Grid Grid.Row="4"
                                          ColumnDefinitions="2*,*,*,*,*,*,*,*,2*"
                                          ColumnSpacing="2">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyShift">
                                            <Label Text="Shift"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="KeyZ">
                                            <Label Text="Z"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeyX">
                                            <Label Text="X"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="KeyC">
                                            <Label Text="C"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="KeyV">
                                            <Label Text="V"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="5"
                                                x:Name="KeyB">
                                            <Label Text="B"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="6"
                                                x:Name="KeyN">
                                            <Label Text="N"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="7"
                                                x:Name="KeyM">
                                            <Label Text="M"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="8"
                                                x:Name="KeyShiftRight">
                                            <Label Text="Shift"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                    </Grid>
                                    <!-- Add bottom row with Ctrl, Alt, Space -->
                                    <Grid Grid.Row="5"
                                          ColumnDefinitions="1.25*,1.25*,5*,1.25*,1.25*"
                                          ColumnSpacing="2">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyCtrl">
                                            <Label Text="Ctrl"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="1"
                                                x:Name="KeyAlt">
                                            <Label Text="Alt"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeySpace">
                                            <Label Text="Space"
                                                   Style="{StaticResource KeyLabelStyle}" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="3"
                                                x:Name="KeyAltRight">
                                            <Label Text="Alt"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="4"
                                                x:Name="KeyCtrlRight">
                                            <Label Text="Ctrl"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="8" />
                                        </Border>
                                    </Grid>
                                    <!-- Arrow keys and special keys -->
                                    <Grid Grid.Row="6"
                                          ColumnDefinitions="*,*,*,*"
                                          ColumnSpacing="4"
                                          Margin="0,8,0,0">
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="0"
                                                x:Name="KeyArrowLeft">
                                            <Label Text="←"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="14" />
                                        </Border>
                                        <StackLayout Grid.Column="1"
                                                     Spacing="2">
                                            <Border StyleClass="KeyboardKey"
                                                    x:Name="KeyArrowUp"
                                                    HeightRequest="28">
                                                <Label Text="↑"
                                                       Style="{StaticResource KeyLabelStyle}"
                                                       FontSize="14" />
                                            </Border>
                                            <Border StyleClass="KeyboardKey"
                                                    x:Name="KeyArrowDown"
                                                    HeightRequest="28">
                                                <Label Text="↓"
                                                       Style="{StaticResource KeyLabelStyle}"
                                                       FontSize="14" />
                                            </Border>
                                        </StackLayout>
                                        <Border StyleClass="KeyboardKey"
                                                Grid.Column="2"
                                                x:Name="KeyArrowRight">
                                            <Label Text="→"
                                                   Style="{StaticResource KeyLabelStyle}"
                                                   FontSize="14" />
                                        </Border>
                                        <StackLayout Grid.Column="3"
                                                     Spacing="2">
                                            <Border StyleClass="KeyboardKey"
                                                    x:Name="KeyDelete"
                                                    HeightRequest="28">
                                                <Label Text="Del"
                                                       Style="{StaticResource KeyLabelStyle}"
                                                       FontSize="8" />
                                            </Border>
                                            <Border StyleClass="KeyboardKey"
                                                    x:Name="KeyEnd"
                                                    HeightRequest="28">
                                                <Label Text="End"
                                                       Style="{StaticResource KeyLabelStyle}"
                                                       FontSize="8" />
                                            </Border>
                                        </StackLayout>
                                    </Grid>
                                </Grid>
                            </ScrollView>
                        </Grid>
                        <!-- Text display for current input activity -->
                        <Border Grid.Row="2"
                                Margin="0,12,0,0"
                                Padding="12,8"
                                StrokeThickness="1"
                                Stroke="{StaticResource BorderColor}"
                                BackgroundColor="{StaticResource BackgroundSecondary}"
                                StrokeShape="RoundRectangle 6,6,6,6">
                            <Label x:Name="ButtonLabel"
                                   Text="No active key/mouse presses"
                                   MaxLines="2"
                                   LineBreakMode="TailTruncation"
                                   Style="{StaticResource BodyTextStyle}"
                                   Margin="0"
                                   HorizontalTextAlignment="Center" />
                        </Border>
                    </Grid>
                </Frame>
            </Grid>
        </VerticalStackLayout>
    </Border>
</ContentView>