<?xml version="1.0" encoding="utf-8"?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CSimple.Components.CapturePreviewCard"
             x:Name="root">
    <Border Style="{StaticResource ModernCardStyle}"
            FlexLayout.Basis="{OnIdiom Phone=100%, Default=48%}"
            FlexLayout.Grow="1"
            MinimumWidthRequest="320">
        <VerticalStackLayout Spacing="12">
            <Label Text="Capture Preview"
                   Style="{StaticResource SubHeaderStyle}" />
            <Grid RowDefinitions="Auto,Auto,Auto"
                  ColumnDefinitions="*,*"
                  Margin="0,8">
                <!-- Screen Preview -->
                <VerticalStackLayout Grid.Row="0"
                                     Grid.Column="0"
                                     Margin="0,0,6,4"
                                     HorizontalOptions="FillAndExpand">
                    <Label Text="Screen Capture"
                           Style="{StaticResource CaptionStyle}" />
                    <Frame Style="{StaticResource PreviewFrameStyle}"
                           HeightRequest="180"
                           WidthRequest="{OnPlatform WinUI=240, Default=160}"
                           HorizontalOptions="FillAndExpand"
                           Margin="0,4,0,0">
                        <Grid>
                            <Image x:Name="ScreenCaptureImage"
                                   Source="{Binding Source={x:Reference Name=root}, Path=ScreenCaptureSource}"
                                   Aspect="AspectFill"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="FillAndExpand" />
                            <!-- Overlay and loading indicator for screen -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference Name=root}, Path=IsScreenCaptureInactive}">
                                <VerticalStackLayout HorizontalOptions="Center"
                                                     VerticalOptions="Center">
                                    <ActivityIndicator IsRunning="{Binding Source={x:Reference Name=root}, Path=IsLoadingScreenPreview}"
                                                       Color="{StaticResource PrimaryColor}"
                                                       HeightRequest="40"
                                                       WidthRequest="40" />
                                    <Label x:Name="ScreenCaptureStatus"
                                           Text="Waiting for screen feed..."
                                           HorizontalOptions="Center"
                                           TextColor="White"
                                           FontSize="12"
                                           MaxLines="2"
                                           LineBreakMode="WordWrap"
                                           HorizontalTextAlignment="Center"
                                           Margin="8,8,8,0" />
                                </VerticalStackLayout>
                            </Grid>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
                <!-- Webcam Preview -->
                <VerticalStackLayout Grid.Row="0"
                                     Grid.Column="1"
                                     Margin="6,0,0,4"
                                     HorizontalOptions="FillAndExpand">
                    <Label Text="Webcam Feed"
                           Style="{StaticResource CaptionStyle}" />
                    <Frame Style="{StaticResource PreviewFrameStyle}"
                           HeightRequest="180"
                           WidthRequest="{OnPlatform WinUI=240, Default=160}"
                           HorizontalOptions="FillAndExpand"
                           Margin="0,4,0,0">
                        <Grid>
                            <Image x:Name="WebcamCaptureImage"
                                   Source="{Binding Source={x:Reference Name=root}, Path=WebcamCaptureSource}"
                                   Aspect="AspectFill"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="FillAndExpand" />
                            <!-- Overlay and loading indicator for webcam -->
                            <Grid BackgroundColor="#80000000"
                                  IsVisible="{Binding Source={x:Reference Name=root}, Path=IsWebcamCaptureInactive}">
                                <VerticalStackLayout HorizontalOptions="Center"
                                                     VerticalOptions="Center">
                                    <ActivityIndicator IsRunning="{Binding Source={x:Reference Name=root}, Path=IsLoadingWebcamPreview}"
                                                       Color="{StaticResource PrimaryColor}"
                                                       HeightRequest="40"
                                                       WidthRequest="40" />
                                    <Label x:Name="WebcamCaptureStatus"
                                           Text="Waiting for webcam feed..."
                                           HorizontalOptions="Center"
                                           TextColor="White"
                                           FontSize="12"
                                           MaxLines="2"
                                           LineBreakMode="WordWrap"
                                           HorizontalTextAlignment="Center"
                                           Margin="8,8,8,0" />
                                </VerticalStackLayout>
                            </Grid>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
                <!-- Input Status -->
                <Frame Grid.Row="1"
                       Grid.Column="0"
                       Grid.ColumnSpan="2"
                       Margin="0,12,0,0"
                       Style="{StaticResource PreviewFrameStyle}"
                       Padding="12">
                    <VerticalStackLayout>
                        <Label Text="Input Activity"
                               Style="{StaticResource CaptionStyle}"
                               Margin="0,0,0,4" />
                        <Label x:Name="ButtonLabel"
                               Text="No active key/mouse presses"
                               MaxLines="4"
                               LineBreakMode="TailTruncation"
                               Style="{StaticResource BodyTextStyle}" />
                    </VerticalStackLayout>
                </Frame>
            </Grid>
        </VerticalStackLayout>
    </Border>
</ContentView>